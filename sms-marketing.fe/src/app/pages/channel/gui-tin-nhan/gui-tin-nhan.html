<div class="card">
    <div class="flex flex-row justify-between items-center mb-4">
        <div class="font-semibold text-xl uppercase">Gửi tin nhắn sms</div>
    </div>
    <app-breadcrumb [home]="home" [items]="items" />
    <div class="grid grid-cols-6 gap-5 mt-5">
        <div class="col-span-4">
            <form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-8">
                <div class="mb-3">
                    <label for="tenChienDich" class="block text-surface-900 dark:text-surface-0 font-medium mb-2">Tên chiến dịch (*)</label>
                    <input pInputText formControlName="tenChienDich" id="tenChienDich" type="text" class="w-full mb-2" />
                    @if (form.get('tenChienDich')?.hasError('required') && form.get('tenChienDich')?.touched) {
                    <p-message severity="error" variant="simple" size="small">{{ getError('tenChienDich') }} </p-message>
                    }
                </div>
                <div class="mb-3">
                    <label for="idBrandName" class="block text-surface-900 dark:text-surface-0 font-medium mb-2">Brandname (*)</label>
                    <p-select id="idBrandName" formControlName="idBrandName" [options]="listBrandname" optionLabel="tenBrandName" optionValue="id" [filter]="true" placeholder="Chọn brandname" class="w-full mb-2" appendTo="body" />
                    @if (form.get('idBrandName')?.hasError('required') && form.get('idBrandName')?.touched) {
                    <p-message severity="error" variant="simple" size="small">{{ getError('idBrandName') }} </p-message>
                    }
                </div>
                <div class="mb-3">
                    <label for="idDanhBa" class="block text-surface-900 dark:text-surface-0 font-medium mb-2">Người nhận (*)</label>
                    <p-select id="idDanhBa" formControlName="idDanhBa" [options]="listDanhBa" optionLabel="tenDanhBa" optionValue="id" [filter]="true" placeholder="Chọn người nhận" class="w-full mb-2" appendTo="body">
                        <ng-template pTemplate="footer">
                            <div class="p-3 border-t border-surface-200 dark:border-surface-700 bg-surface-50 dark:bg-surface-800">
                                <div class="flex flex-col gap-3">
                                    <p-button 
                                        label="Thêm danh bạ mới" 
                                        icon="pi pi-plus-circle" 
                                        severity="secondary" 
                                        [outlined]="true"
                                        class="w-full justify-center hover:bg-surface-100 dark:hover:bg-surface-700 transition-colors duration-200"
                                        size="small"
                                        (onClick)="onOpenCreateDanhBa()" />
                                    <p-button 
                                        label="Thêm danh bạ nhanh" 
                                        icon="pi pi-plus-circle" 
                                        severity="secondary" 
                                        [outlined]="true"
                                        class="w-full justify-center hover:bg-surface-100 dark:hover:bg-surface-700 transition-colors duration-200"
                                        size="small"
                                        (onClick)="onOpenCreateDanhBaNhanh()" />
                                </div>
                            </div>
                        </ng-template>
                    </p-select>
                    @if (form.get('idDanhBa')?.hasError('required') && form.get('idDanhBa')?.touched) {
                    <p-message severity="error" variant="simple" size="small">{{ getError('idDanhBa') }} </p-message>
                    }
                </div>
                <div class="mb-3">
                    @if (selectedDanhBa?.truongData) {
                        @for (item of selectedDanhBa?.truongData; track $index) {
                            <p-chip [label]="item.tenTruong" class="cursor-pointer m-1" (click)="insertAtCursor(messageInput, item.tenTruong || '')" />
                        }
                    }
                </div>
                <div class="mb-3">
                    <label for="noiDung" class="block text-surface-900 dark:text-surface-0 font-medium mb-2">Nội dung tin nhắn (*)</label>
                    <textarea pTextarea #messageInput formControlName="noiDung" id="noiDung" type="text" class="w-full mb-2" rows="4"></textarea>
                    @if (form.get('noiDung')?.hasError('required') && form.get('noiDung')?.touched) {
                    <p-message severity="error" variant="simple" size="small">{{ getError('noiDung') }} </p-message>
                    }
                </div>
                
                <div class="flex items-center mb-3">
                    <p-checkbox inputId="isAccented" name="isAccented" formControlName="isAccented" [binary]="true" />
                    <label for="isAccented" class="ml-2 cursor-pointer">Gửi có dấu</label>
                </div>
                <div class="mt-5 flex flex-row justify-end space-x-3">
                    <p-button label="Lưu" icon="pi pi-save" type="button" severity="secondary" (onClick)="onClickSave()" [loading]="loading" />
                    <p-button label="Gửi" icon="pi pi-send" type="submit" [loading]="loading" />
                </div>
            </form>
        </div>
        <div class="col-span-2">
            <app-mobile-preview 
                [idChienDich]="idChienDich" 
                [idBrandName]="form.value['idBrandName']" 
                [idDanhBa]="form.value['idDanhBa']" 
                [isAccented]="form.value['isAccented']" 
                [noiDung]="form.value['noiDung']" 
            />
        </div>
    </div>
</div>