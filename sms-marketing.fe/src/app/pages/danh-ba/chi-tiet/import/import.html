<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <div class="flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
        <i class="pi pi-download text-blue-600 dark:text-blue-400"></i>
        <a (click)="downloadImportTemplate()" class="text-blue-600 dark:text-blue-400 hover:underline cursor-pointer font-medium">Tải file mẫu import</a>
    </div>

    <div>
        <label for="File" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">File Excel <span class="text-red-500">*</span></label>
        <p-fileupload id="File" mode="basic" (onSelect)="onSelect($event)" chooseLabel="Chọn file" chooseIcon="pi pi-upload" accept=".xlsx,.xls" styleClass="w-full" [auto]="true" />
        @if (form.get('File')?.hasError('required') && form.get('File')?.touched) {
        <small class="text-red-500 mt-1 block">{{ getError('File') }}</small>
        }
    </div>

    <div>
        <label for="IndexColumnHoTen" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">Cột họ và tên <span class="text-red-500">*</span></label>
        <input pInputText formControlName="IndexColumnHoTen" id="IndexColumnHoTen" type="number" placeholder="Nhập số thứ tự cột (VD: 1, 2, 3...)" class="w-full" />
        @if (form.get('IndexColumnHoTen')?.hasError('required') && form.get('IndexColumnHoTen')?.touched) {
        <small class="text-red-500 mt-1 block">{{ getError('IndexColumnHoTen') }}</small>
        }
    </div>

    <div>
        <label for="IndexColumnSoDienThoai" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">Cột số điện thoại <span class="text-red-500">*</span></label>
        <input pInputText formControlName="IndexColumnSoDienThoai" id="IndexColumnSoDienThoai" type="number" placeholder="Nhập số thứ tự cột (VD: 1, 2, 3...)" class="w-full" />
        @if (form.get('IndexColumnSoDienThoai')?.hasError('required') && form.get('IndexColumnSoDienThoai')?.touched) {
        <small class="text-red-500 mt-1 block">{{ getError('IndexColumnSoDienThoai') }}</small>
        }
    </div>

    <div class="border-t pt-4">
        <div class="relative">
            <button type="button" (click)="op.toggle($event)" class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-surface-50 dark:bg-surface-800 hover:bg-surface-100 dark:hover:bg-surface-700 border border-surface-300 dark:border-surface-600 rounded-lg transition-colors">
                <i class="pi pi-cog text-lg"></i>
                <span class="font-semibold">Cài đặt nâng cao</span>
                <i class="pi pi-angle-down ml-auto"></i>
            </button>
            <p-popover #op appendTo="body" [style]="{'margin-top': '0.5rem'}">
                <div class="space-y-4 p-4 w-80">
                    <div>
                        <label for="SheetName" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">Tên sheet <span class="text-red-500">*</span></label>
                        <p-select formControlName="SheetName" id="SheetName" [options]="sheetNameOptions" optionLabel="label" optionValue="value" placeholder="Chọn sheet" styleClass="w-full" />
                        @if (form.get('SheetName')?.hasError('required') && form.get('SheetName')?.touched) {
                        <small class="text-red-500 mt-1 block">{{ getError('SheetName') }}</small>
                        }
                    </div>

                    <div>
                        <label for="IndexRowStartImport" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">Dòng bắt đầu có dữ liệu <span class="text-red-500">*</span></label>
                        <input pInputText formControlName="IndexRowStartImport" id="IndexRowStartImport" type="number" placeholder="Nhập số dòng (VD: 5)" class="w-full" />
                        @if (form.get('IndexRowStartImport')?.hasError('required') && form.get('IndexRowStartImport')?.touched) {
                        <small class="text-red-500 mt-1 block">{{ getError('IndexRowStartImport') }}</small>
                        }
                    </div>

                    <div>
                        <label for="IndexRowHeader" class="block text-sm font-semibold text-surface-900 dark:text-surface-0 mb-2">Dòng tiêu đề <span class="text-red-500">*</span></label>
                        <input pInputText formControlName="IndexRowHeader" id="IndexRowHeader" type="number" placeholder="Nhập số dòng (VD: 4)" class="w-full" />
                        @if (form.get('IndexRowHeader')?.hasError('required') && form.get('IndexRowHeader')?.touched) {
                        <small class="text-red-500 mt-1 block">{{ getError('IndexRowHeader') }}</small>
                        }
                    </div>
                </div>
            </p-popover>
        </div>
    </div>

    <div class="flex justify-end pt-4 border-t">
        <p-button label="Import dữ liệu" icon="pi pi-file-import" type="submit" [loading]="loading" />
    </div>
</form>