<div class="card">
    <div class="flex flex-row justify-between items-center mb-4">
        <div class="font-semibold text-xl uppercase">Thống kê chiến dịch gửi SMS</div>
    </div>

    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
        <div class="flex flex-row justify-between items-end space-x-2">
            <div class="flex flex-row justify-between align-items-end space-x-2 flex-1">
                <div class="flex flex-col justify-end flex-1 max-w-xl">
                    <p-iconfield class="w-full">
                        <p-inputicon class="pi pi-search" />
                        <input formControlName="search" pInputText type="text" placeholder="Tìm kiếm chiến dịch..." class="w-full" />
                    </p-iconfield>
                </div>
            </div>
            <div class="flex flex-row space-x-2">
                <p-button label="Tìm kiếm" type="submit" styleClass="w-32 flex-shrink-0" />
                @if (isExportMode) {
                    <p-button type="button" icon="pi pi-download" label="Export" [disabled]="selectedChienDichs.length === 0" [loading]="loading" (click)="onConfirmExport()" />
                    <p-button type="button" icon="pi pi-times" label="Hủy" severity="secondary" (click)="onExportTheoChienDich()" />
                } 
                @else {
                    <p-button #exportBtn icon="pi pi-download" type="button" label="Export" (click)="exportPopover.toggle($event)" />
                }
            </div>
        </div>
    </form>

    <div class="mt-4">
        <app-data-table [columns]="columns" [data]="data" [loading]="loading" (onCustomComp)="onCustomEmit($event)" [total]="totalRecords" [pageNumber]="query.pageNumber" [pageSize]="query.pageSize" (onPageChanged)="onPageChanged($event)" />
    </div>
</div>

<p-popover #exportPopover>
    <div class="flex flex-row space-x-0">
        <div class="flex flex-col space-y-2 p-2">
            <p-button #monthBtn label="Export theo tháng" icon="pi pi-calendar" [loading]="loading" (onClick)="monthPopover.toggle($event)" styleClass="w-full justify-center" />
            <p-button label="Export theo chiến dịch" icon="pi pi-list" [loading]="loading" (onClick)="onExportTheoChienDich()" styleClass="w-full justify-center" />
        </div>
    </div>
</p-popover>

<p-popover #monthPopover [appendTo]="'body'">
    <div class="p-4 min-w-[280px]">
        <div class="font-semibold mb-3">Chọn tháng/năm</div>
        <p-datepicker [(ngModel)]="selectedMonthYear" view="month" dateFormat="mm/yy" (onSelect)="onMonthYearSelect()" [inline]="true" class="w-full"> </p-datepicker>
    </div>
</p-popover>

<p-confirmDialog></p-confirmDialog>
